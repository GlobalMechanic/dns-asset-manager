<div id="asset-<%= asset.id %>" class="asset" draggable="true">
  <% if reel %>
    <% if reel.assets.map {|asset| asset[:id] }.include?(asset.id) %>
    <%= link_to 'Remove from Reel', reel_asset_path(reel, asset), method: :delete, :draggable => false, :id => 'asset-' + asset.id.to_s, :class => 'reel remove' %>
    <% else %>
    <%= link_to 'Add to Reel', reel_asset_path(reel, asset), method: :post, :draggable => false, :id => 'asset-' + asset.id.to_s, :class => 'reel add' %>
    <% end %>
  <% end %>
  <div class="title"><%= asset.title %></div>

  <% preview = asset.preview? ? 'preview' : 'asset' %>
  <% if previewable(asset.send(preview)) && is_image(asset.send(preview)) %>
  <%= image_tag asset.preview_url(:thumb).to_s, :class => 'default', :draggable => 'false' %>
  <% elsif is_image asset.asset %>
  <%= image_tag asset.asset_url(:thumb).to_s, :class => 'default', :draggable => 'false' %>
  <% elsif is_movie asset.asset %>
  <video class="default" preload="metadata" src="<%= asset.asset_url %>"></video>
  <% else %>
  <%= image_tag '/assets/placeholders/' + clean_extension(asset.asset) + '.png', :class => 'default', :draggable => 'false' %>
  <% end %>

  <div class="asset-workflow row">
  <%# if %>
    <%# if checked out %> 
      <!-- <div class="checkout asset-state">out</div>
      <p class="assigned-to">Chet Earl Woodside Chet Earl Woodside</p> -->
    <%# else %>
      <div class="checkin asset-state">
      <%= link_to 'Download Asset', asset_download_path(asset) %>
      </div>
      <%# if assigned %>
      <!-- <p class="assigned-to">Chet Earl Woodside Chet Earl Woodside</p> -->
      <%# end %>
    <%# end %>
  <%# end %>
  </div>

  <div class="extended">
    <div class="title"><%= asset.title %></div>
    <div class="tab-tile">

      <%# Download section %>
      <div class="tile">
       <p class="downloads">
          <%= link_to 'Download Asset', asset_download_path(asset), :class => 'button' %>
        </p>
      </div> 

      <%# Versions section %>
      <div class="tile">
        <table class="detail">
          <caption>Versions</caption>
          <thead>
            <tr>
              <th>Who</th>
              <th>What</th>
              <th>When</th>
            </tr>
          </thead>
          <tbody>
          <% asset.versions.reverse.each do |version| %>
            <tr>
              <td><%= version.whodunnit? ? User.find(version.whodunnit).name : '-' %></td>
              <td><%= version.event.titleize %></td>
              <td><%= time_ago_in_words(version.created_at) %> ago</td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>

      <%# Asset details section %>
      <div class="tile">
        <% if can? :update, Asset %>
        <a href="<%= asset_path asset %>/edit" class="button">Edit Asset</a>
        <% end %>
        <dl>
          <% if asset.scene.length > 0 %>
          <dt>Episodes:</dt>
          <dd>
            <% Episode.joins(:scenes).where(:scenes => { :id => asset.scene.map {|item| item.id} }).uniq.order("episodes.number ASC").each do |episode| %>
              <%= link_to episode.title, episode %>
            <% end %>
          </dd>
          <% end %>
          <% if asset.name_list.length > 0 %>
          <dt>Name:</dt>
          <dd>
            <% asset.name_list.each do |keyword| %>
              <%= link_to keyword, keyword_assets_path(keyword) %>
            <% end %>
          </dd>
          <% end %>
          <% if asset.keyword_list.length > 0 %>
          <dt>Keywords:</dt>
          <dd>
            <% asset.keyword_list.each do |keyword| %>
              <%= link_to keyword, keyword_assets_path(keyword) %>
            <% end %>
          </dd>
          <% end %>
          <% if asset.description? %>
          <dt>Description:</dt>
          <dd><%= asset.description %></dd>
          <% end %>
          <% if asset.scene.length <= 0 && asset.name_list.length <= 0 && asset.keyword_list.length <= 0 && !asset.description? %>
           <p>No extra information.</p>
          <% end %>
        </dl>
      </div>

      <%# Video section%>
      <% preview = asset.preview? ? 'preview' : 'asset' %>
      <% if previewable(asset.send(preview)) %>
      <div class="tile">
        <% if is_image(asset.send(preview)) %>
        <div class="detail" data-image-url="<%= asset.send(preview + '_url') %>"></div>
        <% elsif is_movie(asset.send(preview)) %>
        <video src="<%= asset.send(preview + '_url') %>" controls="controls" preload="metadata"></video>
        <% elsif is_audio(asset.send(preview)) %>
        <audio src="<%= asset.send(preview + '_url') %>" controls="controls" preload="metadata"></audio>
        <% elsif is_flash(asset.send(preview)) %>
        <div data-flash-url="<%= asset.send(preview + '_url') %>"></div>
        <% else %>
        <%= image_tag '/assets/placeholders/' + clean_extension(asset.send(preview)) + '.png', :class => 'default', :draggable => 'false' %>
        <% end %>
      </div>
      <% end %>

    </div>    

    <nav class="row asset-utilities">
      <ul>
        <li><a href="#download">Download</a></li>
        <li><a href="#versions">Versions</a></li>
        <li><a href="#details">Details</a></li>
        <% if previewable(asset.send(preview)) %>
        <li><a href="#video">Video</a></li>
        <% end %>
      </ul>
    </nav>

    <% if can? :update, Asset %>
      <%= form_for asset do |f| %>
        <%= f.autocomplete_field :keyword_list, autocomplete_tag_name_assets_path, :"data-delimiter" => ', ', :multiple => true, :placeholder => 'Keyword List' %>
      <% end %>
    <% end %>
  </div>
</div>
